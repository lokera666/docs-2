## Customization

### Customize Object Key Path

You can customize your key path by defining a prefix resolver:

```dart
// Define your own prefix resolver, that conforms to `StorageS3PrefixResolver`
class MyCustomPrefixResolver implements StorageS3PrefixResolver {
  @override
  Future<String> resolvePrefix({
    required StorageAccessLevel storageAccessLevel,
    String? identityId,
  }) async {
    switch (storageAccessLevel) {
      case StorageAccessLevel.guest:
        return 'myPublicPrefix/';
      case StorageAccessLevel.protected:
        return 'myProtectedPrefix/${identityId!}/';
      case StorageAccessLevel.private:
        return 'myPrivatePrefix/${identityId!}/';
    }
  }
}
```

Then configure the storage plugin with the resolver.

```dart
final storagePlugin = AmplifyStorageS3(prefixResolver: MyCustomPrefixResolver());
await Amplify.addPlugin(storagePlugin);
```

Add the IAM policy that corresponds with the prefixes defined above to enable read, write and delete operation for all the objects under path _myPublicPrefix/_:

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Action": [
                "s3:PutObject",
                "s3:GetObject",
                "s3:DeleteObject"
            ],
            "Resource": [
                "arn:aws:s3:::your-s3-bucket/myPublicPrefix/*"
            ],
            "Effect": "Allow"
        }
    ]
}

If you want to have custom _private_ path prefix like `myPrivatePrefix/`, you need to add permissions to the IAM policy of your authenticated users. For example, for the given IAM principal (default authenticated role for Amplify projects):

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Principal": {
                "Federated": "cognito-identity.amazonaws.com"
            },
            "Action": "sts:AssumeRoleWithWebIdentity",
            "Condition": {
                "StringEquals": {
                    "cognito-identity.amazonaws.com:aud": "<identity pool ID>"
                },
                "ForAnyValue:StringLike": {
                    "cognito-identity.amazonaws.com:amr": "authenticated"
                }
            }
        }
    ]
}

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Action": [
                "s3:PutObject",
                "s3:GetObject",
                "s3:DeleteObject"
            ],
            "Resource": [
                "arn:aws:s3:::your-s3-bucket/myPrivatePrefix/${cognito-identity.amazonaws.com:sub}/*"
            ],
            "Effect": "Allow"
        }
    ]
}

#### Passthrough PrefixResolver

If you would like no prefix resolution logic, such as performing S3 requests at the root of the bucket, create a prefix resolver that returns an empty string:

```dart
class PassThroughPrefixResolver implements StorageS3PrefixResolver {
  @override
  Future<String> resolvePrefix({
    required StorageAccessLevel storageAccessLevel,
    String? identityId,
  }) async {
    return '';
  }
}
```
